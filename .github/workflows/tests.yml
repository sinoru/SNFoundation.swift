name: Tests

on: [push]

jobs:
  build:

    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [ubuntu-16.04, ubuntu-18.04, macOS-latest]
        swift: [5.0, 5.1]
        exclude:
          - os: macos-latest
            swift: 5.0

    steps:
    - uses: actions/checkout@v1
    - name: Run tests in native
      if: contains(runner.os, 'macOS')
      run: swift test -v
    - name: Run tests in xenial container
      if: runner.os == 'ubuntu-16.04'
      run: docker run -v ${{ github.workspace }}:/mnt -w /mnt --cap-add sys_ptrace -it --rm swift:${{ matrix.swift }}-xenial swift test -v
    - name: Run tests in bionic container
      if: runner.os == 'ubuntu-18.04'
      run: docker run -v ${{ github.workspace }}:/mnt -w /mnt --cap-add sys_ptrace -it --rm swift:${{ matrix.swift }}-bionic swift test -v
